<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ISR OPS ENTRY</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
  th { background: #f0f0f0; }
  input[type="number"] { width: 60px; }
</style>
</head>
<body>

<h2>ISR OPS Entry</h2>
<form id="productForm">
  <label><b>Date:</b> <input type="date" id="date" required></label>
  <label><b>Person Name:</b> <input type="text" id="personName" required></label>
  <button type="button" id="loadBtn">Load Existing Data</button>

  <table id="skuTable">
    <thead>
      <tr>
        <th>SKU</th>
        <th colspan="2">Opening</th>
        <th colspan="2">Primary</th>
        <th colspan="2">Secondary</th>
      </tr>
      <tr>
        <th></th>
        <th>Loose</th><th>IC</th>
        <th>Loose</th><th>IC</th>
        <th>Loose</th><th>IC</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button type="submit">Submit</button>
</form>

<script>
const SKUS = ["RG1.25G","RG2.20G","RG4.00G","RGZ17.00G","RG100.00G",
               "TZ0.25G","TZ0.45G","TZZ4.25G","TZ10G","TZ50G",
               "KH5.75G","KH30.00G","MT2.75G"];

const scriptURL = "https://script.google.com/macros/s/AKfycbybskgSZeOjWCnPsjjf_hjdPbh5K7AddLE9IAorZ-Q6-bt5565o4_QINafU9zsNR-T5/exec";

const tbody = document.querySelector("#skuTable tbody");
SKUS.forEach(sku => {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td>${sku}</td>
    <td><input type="number" name="openingLoose_${sku}"></td>
    <td><input type="number" name="openingIC_${sku}"></td>
    <td><input type="number" name="primaryLoose_${sku}"></td>
    <td><input type="number" name="primaryIC_${sku}"></td>
    <td><input type="number" name="secondaryLoose_${sku}"></td>
    <td><input type="number" name="secondaryIC_${sku}"></td>
  `;
  tbody.appendChild(row);
});

// Load existing data
document.getElementById("loadBtn").addEventListener("click", () => {
  const date = document.getElementById("date").value;
  const person = document.getElementById("personName").value.trim();
  if (!date || !person) return alert("Please fill date and name.");

  fetch(`${scriptURL}?date=${encodeURIComponent(date)}&personName=${encodeURIComponent(person)}`)
    .then(res => res.json())
    .then(data => {
      for (const sku in data) {
        const obj = data[sku];
        document.querySelector(`input[name="openingLoose_${sku}"]`).value = obj.openingLoose || "";
        document.querySelector(`input[name="openingIC_${sku}"]`).value = obj.openingIC || "";
        document.querySelector(`input[name="primaryLoose_${sku}"]`).value = obj.primaryLoose || "";
        document.querySelector(`input[name="primaryIC_${sku}"]`).value = obj.primaryIC || "";
        document.querySelector(`input[name="secondaryLoose_${sku}"]`).value = obj.secondaryLoose || "";
        document.querySelector(`input[name="secondaryIC_${sku}"]`).value = obj.secondaryIC || "";
      }
      alert("Data loaded successfully!");
    })
    .catch(err => alert("Error loading data: " + err.message));
});

// Submit form
document.getElementById("productForm").addEventListener("submit", e => {
  e.preventDefault();
  const date = document.getElementById("date").value;
  const personName = document.getElementById("personName").value.trim();

  const skuData = SKUS.map(sku => ({
    sku,
    openingLoose: document.querySelector(`input[name="openingLoose_${sku}"]`).value,
    openingIC: document.querySelector(`input[name="openingIC_${sku}"]`).value,
    primaryLoose: document.querySelector(`input[name="primaryLoose_${sku}"]`).value,
    primaryIC: document.querySelector(`input[name="primaryIC_${sku}"]`).value,
    secondaryLoose: document.querySelector(`input[name="secondaryLoose_${sku}"]`).value,
    secondaryIC: document.querySelector(`input[name="secondaryIC_${sku}"]`).value
  }));

  fetch(scriptURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ date, personName, skuData })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") alert("✅ Data submitted successfully!");
    else alert("❌ Error: " + data.message);
  })
  .catch(err => alert("Network error: " + err.message));
});
</script>
</body>
</html>
